name: Release

env:
  solution: Pagoog.sln

on:
  # Create a release whenever we push against a tag
  push:
    tags:
      - 'v*'
  # Allow us to run the workflow manually
  workflow_dispatch:

# Build dist on Windows for x64 machines
jobs:
  Dist-Windows-x64:
    runs-on: windows-latest

    steps:
      - uses: actions/checkout@v2.3.4

      - name: Add MSBuild to PATH
        uses: microsoft/setup-msbuild@v1

      - name: Set up projects and solution
        working-directory: ${{github.workspace}}\Source
        run: .\SetupSolution_VS2019.bat
        
      - name: Build solution
        working-directory: ${{github.workspace}}\Source
        run: msbuild /v:normal /m /p:Configuration=Dist /p:Platform=x64 ${{env.solution}}
        
      - name: Create release
        uses: zendesk/action-create-release@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }} # This token is provided by Actions, you do not need to create your own token
        with:
          auto_increment_type: major
          tag_schema: semantic
          draft: false
          prerelease: false
          
      - name: Add build to release
        uses: Roang-zero1/github-upload-release-artifacts-action@master
        with:
          args: ${{github.workspace}}\Source\Builds
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          
